# -*- makefile -*-

all: installed.viocevox_core

VERSION = 0.12.4
MD5SUM_DIR = $(CURDIR)/md5sum
ifeq ($(shell uname -m),x86_64)
	DIRNAME = voicevox_core-linux-x64-cpu-$(VERSION)
	FILENAME = voicevox_core-linux-x64-cpu-$(VERSION).zip
	SOURCE_DIR = build/voicevox_core-linux-x64-cpu-$(VERSION)
	MD5SUM_FILE = $(MD5SUM_DIR)/core-linux-x64-cpu.md5sum
endif
ifeq ($(shell uname -m),aarch64)
	DIRNAME = voicevox_core-linux-arm64-cpu-$(VERSION)
	FILENAME = voicevox_core-linux-arm64-cpu-$(VERSION).zip
	SOURCE_DIR = build/voicevox_core-linux-arm64-cpu-$(VERSION)
	MD5SUM_FILE = $(MD5SUM_DIR)/core-linux-arm64-cpu.md5sum
endif

TARBALL_URL = "https://github.com/VOICEVOX/voicevox_core/releases/download/$(VERSION)/$(FILENAME)"
TARBALL = build/$(FILENAME)
UNPACK_CMD = unzip
SCRIPT_DIR = $( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )
include $(shell rospack find mk)/download_unpack_build.mk
INSTALL_DIR =	'./'


installed.viocevox_core: $(SOURCE_DIR)/unpacked
	mkdir -p $(INSTALL_DIR)/lib
	cp build/$(DIRNAME)/lib*.so $(INSTALL_DIR)/lib/

clean:
	rm -rf $(TARBALL)
	rm -rf $(SOURCE_DIR)
	rm -rf $(INSTALL_DIR)/lib
	rm -rf build
