<launch>

  <arg name="device" default="" />
  <arg name="launch_sound_play" default="true" />
  <arg name="sound_play_respawn" default="true"
       doc="Respawn sound_play node or not (default: true)" />
  <arg name="default_speaker" default="$(optenv VOICEVOX_DEFAULT_SPEAKER_ID 2)"
       doc="Default speaker for VOICEVOX" />
  <arg name="host" default="$(optenv VOICEVOX_TEXTTOSPEECH_URL localhost)" />
  <arg name="port" default="$(optenv VOICEVOX_TEXTTOSPEECH_PORT 50021)" />
  <arg name="cpu_num_threads" default="1"
       doc="Number of cpu threads" />
  <arg name="use_docker" default="false"
       doc="Use docker or not (default: false)" />
  <arg name="docker_only" default="false"
       doc="Launch only docker container without sound_play node (default: false)" />
  <arg name="remote_only" default="false"
       doc="Connect to remote server without starting local server (default: false)" />

  <node name="voicevox_server"
        pkg="voicevox" type="run-voicevox"
        args="--voicelib_dir=$(find voicevox)/voicevox_core --host 0.0.0.0 --port $(arg port) --cpu_num_threads=$(arg cpu_num_threads) --load_all_models --"
        respawn="$(arg sound_play_respawn)"
        output="screen"
        unless="$(eval arg('use_docker') or arg('docker_only') or arg('remote_only') or (arg('host') != 'localhost' and arg('host') != '127.0.0.1'))">
  </node>

  <node name="voicevox_docker_server"
        pkg="voicevox" type="run-voicevox-docker"
        args="--host $(arg host) --port $(arg port) --cpu_num_threads=$(arg cpu_num_threads) --"
        respawn="$(arg sound_play_respawn)"
        output="screen"
        if="$(eval arg('use_docker') or arg('docker_only'))">
  </node>

  <node if="$(eval arg('launch_sound_play') and not arg('docker_only'))"
        name="sound_play_jp"
        pkg="sound_play" type="soundplay_node.py"
        respawn="$(arg sound_play_respawn)"
        output="screen" >
    <remap from="robotsound" to="robotsound_jp"/>
    <remap from="sound_play" to="robotsound_jp"/>
    <param name="device" value="$(arg device)" />
    <env name="VOICEVOX_DEFAULT_SPEAKER_ID" value="$(arg default_speaker)" />
    <env name="VOICEVOX_TEXTTOSPEECH_URL" value="$(arg host)" />
    <env name="VOICEVOX_TEXTTOSPEECH_PORT" value="$(arg port)" />
    <env name="PATH" value="$(find voicevox)/bin:$(env PATH)" />
    <env name="PYTHONIOENCODING" value="utf-8" />
  </node>
</launch>
